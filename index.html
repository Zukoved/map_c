<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Завоевание Галлии Цезарем — интерактивная карта</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    :root{
      --bg:#111; --fg:#eaeaea; --muted:#9aa0a6; --accent:#4f46e5; --panel:#1b1b1b; --border:#2a2a2a;
      --red:#d93741; --yellow:#f0c419; --blue:#4aa3ff; --ally:#22c55e;
    }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, sans-serif; }
    #app { display:grid; grid-template-columns: 320px 1fr; height:100%; }
    #sidebar { background:var(--panel); border-right:1px solid var(--border); padding:14px; overflow:auto; }
    #map { width:100%; height:100%; }
    h1 { font-size:18px; margin:0 0 8px; }
    .muted { color:var(--muted); font-size:12px; }
    .control { margin:14px 0; }
    .row { display:flex; align-items:center; gap:8px; }
    .btn { cursor:pointer; border:1px solid var(--border); background:#222; color:var(--fg); padding:6px 10px; border-radius:8px; }
    .btn:hover { border-color:#444; }
    input[type="range"]{ width:100%; }
    .legend { display:grid; grid-template-columns: 14px auto; gap:8px 10px; margin-top:8px; align-items:center; }
    .dot { width:14px; height:14px; border-radius:50%; border:1px solid #0006; }
    .dot.city{ background:var(--blue); }
    .dot.tribe{ background:var(--yellow); }
    .dot.conq{ background:var(--red); }
    .dot.ally{ background:var(--ally); }
    details { border:1px solid var(--border); border-radius:10px; padding:8px 10px; background:#161616; }
    summary { cursor:pointer; }
    .small { font-size:12px; }
  </style>
</head>
<body>
<div id="app">
  <aside id="sidebar">
    <h1>Завоевание Галлии Цезарем</h1>
    <div class="muted">Все племена (жёлтые) и города (синие) видны всегда; по мере продвижения по времени объекты меняют цвет на красный при захвате, а при утрате контроля возвращаются к исходному цвету. Союзники подсвечиваются зелёным.</div>

    <div class="control">
      <div class="row" style="justify-content:space-between;">
        <div class="muted">Диапазон: 59–50 гг. до н.э.</div>
        <button id="play" class="btn" title="Воспроизвести/пауза">▶</button>
      </div>
      <!-- Лево (0) = янв 59 до н.э., право (119) = дек 50 до н.э. -->
      <input id="time" type="range" min="0" max="119" step="1" value="0" />
      <div id="dateLabel" class="row" style="justify-content:space-between;">
        <div>Дата:</div><strong id="dateOut">янв 59 до н.э.</strong>
      </div>
    </div>

    <details open>
      <summary>Легенда</summary>
      <div class="legend">
        <div class="dot tribe"></div><div>Племя (область)</div>
        <div class="dot city"></div><div>Город (точка)</div>
        <div class="dot conq"></div><div>Захвачено Римом</div>
        <div class="dot ally"></div><div>Союзник Рима</div>
      </div>
    </details>

    <details style="margin-top:10px;">
      <summary>Фильтры</summary>
      <div class="control small">
        <label><input type="checkbox" id="showTribeAreas" checked> Контуры племён (полигоны)</label><br/>
        <label><input type="checkbox" id="showTribePoints"> Племена (точки)</label><br/>
        <label><input type="checkbox" id="showCities" checked> Показать города</label>
      </div>
    </details>

    <details style="margin-top:10px;">
      <summary>О проекте</summary>
      <div class="small muted">
        Даты и события могут содержать неточности и требуют дополнительной проверки. Контуры племён являются приблизительными.
      </div>
    </details>

  </aside>
  <main id="map"></main>
</div>
<script>
// ===== ВРЕМЕННАЯ ШКАЛА =====
// Индекс 0 = янв 59 до н.э.; 119 = дек 50 до н.э. (слева → направо = вперёд по времени)
const MONTHS = ["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"];
function idxToLabel(i){
  const yOff = Math.floor(i/12); const m = i%12;
  const yearBCE = 59 - yOff; // 59,58,...,50
  return `${MONTHS[m]} ${yearBCE} до н.э.`;
}
function idxToKey(i){
  const yOff = Math.floor(i/12); const m = (i%12)+1;
  const y = 59 - yOff; // год до н.э.
  const mm = String(m).padStart(2,'0');
  return `-${y}-${mm}`; // напр. "-52-04"
}
function keyToIdx(key){
  const m = key.match(/-(\d{2})-(\d{2})/);
  if(!m) return -Infinity;
  const year = parseInt(m[1],10); // 59..50
  const mon = parseInt(m[2],10);  // 1..12
  return (59 - year)*12 + (mon-1); // 0..119
}
function compareKeysChrono(a,b){ return keyToIdx(a) - keyToIdx(b); }
function slugify(s){ return String(s).toLowerCase().replace(/[^\w-]+/g,'_'); }

// ===== ДАННЫЕ ENTITIES =====
// Каждый объект: { name, type:'tribe'|'city', lat, lon, baseColor:'tribe'|'city', info:{history,about}, cite, events:[{date:'-YY-MM',status:'Conquered'|'Ally'|'Revolt',note}], area?: [[lat,lon],...] }
const ENTITIES = [
  // ==== ПЛЕМЕНА ====
  { name:"Menapii (Менапии)", type:"tribe", lat:50.73, lon:2.03, baseColor:"tribe",
    info:{ history:"Сопротивление в 57–55 гг.; римские рейды в болота и леса.", about:"Бельгийское прибрежное племя к северу от Белловаков." }, cite:"Pleiades; BG 4.4",
    events:[ {date:"-57-08", status:"Revolt", note:"Отказываются от мира"}, {date:"-55-08", status:"Conquered", note:"Подчинены после карательной кампании"} ] },
  { name:"Morini (Морины)", type:"tribe", lat:50.73, lon:2.12, baseColor:"tribe",
    info:{ history:"57–55 гг.: партизанская война; подавлены к экспедициям в Британию.", about:"Прибрежные бельги у Ла-Манша." }, cite:"Pleiades",
    events:[ {date:"-57-08", status:"Revolt", note:"Леса и болота помогают обороне"}, {date:"-55-08", status:"Conquered", note:"Оставлены римские гарнизоны"} ] },
  { name:"Eburones (Эбуроны)", type:"tribe", lat:50.78, lon:5.47, baseColor:"tribe",
    info:{ history:"54–53 гг.: восстание Амбиорикса; Caesar карает племя.", about:"Между Маасом и Рейном (район Тонгерен–Маастрихт)." }, cite:"Livius; WP",
    events:[ {date:"-54-11", status:"Revolt", note:"Разгром лагеря Сабина и осада Цицерона"}, {date:"-53-07", status:"Conquered", note:"Карательные экспедиции"} ] },
  { name:"Atrebates (Атребаты)", type:"tribe", lat:50.39, lon:2.66, baseColor:"tribe",
    info:{ history:"После 57 г. поддерживают восстание; поражены у Алезии (52).", about:"Артуа, центр у Нематокенны (Аррас)." }, cite:"Pleiades",
    events:[ {date:"-52-09", status:"Conquered", note:"Поражение при Алезии"} ] },
  { name:"Bellovaci (Белловаки)", type:"tribe", lat:49.43, lon:2.08, baseColor:"tribe",
    info:{ history:"Формально покорены 57; восстание 51 — подавлено.", about:"Окрестности Бове (Caesaromagus)." }, cite:"WP",
    events:[ {date:"-57-07", status:"Conquered", note:"Кампания против белгов"}, {date:"-51-04", status:"Revolt", note:"Подъём Кориоса; усмирены"} ] },
  { name:"Helvetii (Гельветы)", type:"tribe", lat:46.95, lon:7.44, baseColor:"tribe",
    info:{ history:"58 г.: разгром у Бибракте и возвращение на места проживания.", about:"Кельтская конфедерация Швейцарского плато." }, cite:"Britannica",
    events:[ {date:"-58-06", status:"Conquered", note:"Поражены при Бибракте"} ] },
  { name:"Sequani (Секваны)", type:"tribe", lat:47.24, lon:6.02, baseColor:"tribe",
    info:{ history:"58 г.: после изгнания Ариовиста под влиянием Рима.", about:"Юра, верховья Саоны/Дубса (Безансон)." }, cite:"WP",
    events:[ {date:"-58-09", status:"Conquered", note:"После победы над германцами"} ] },
  { name:"Aedui/Haedui (Эдуи)", type:"tribe", lat:46.95, lon:4.30, baseColor:"tribe",
    info:{ history:"С 58 г. союзники; в 52 г. колебания, затем возвращение к союзу.", about:"Бургундия; центры Бибракте/Августодунум (Отан)." }, cite:"WP",
    events:[ {date:"-58-07", status:"Ally", note:"Союз с Римом"}, {date:"-52-05", status:"Revolt", note:"Часть знати с Верцингеториксом"}, {date:"-52-09", status:"Ally", note:"Возврат к союзу"} ] },
  { name:"Lingones (Лингоны)", type:"tribe", lat:47.86, lon:5.33, baseColor:"tribe",
    info:{ history:"В целом лояльны Риму; стратегический узел путей.", about:"Округ Лангра; столица Андематуннум (Langres)." }, cite:"WP",
    events:[ {date:"-57-07", status:"Ally", note:"Склонены к союзу"} ] },
  { name:"Parisii (Парисии)", type:"tribe", lat:48.86, lon:2.35, baseColor:"tribe",
    info:{ history:"52 г.: участие в восстании; район Лютеции под контролем Рима к концу кампании.", about:"Племя на Сене; дало имя Парижу." }, cite:"WP",
    events:[ {date:"-52-07", status:"Revolt", note:"Поддержка Верцингеторикса"}, {date:"-52-10", status:"Conquered", note:"Кампания Лабиена"} ] },
  { name:"Senones (Сеноны)", type:"tribe", lat:48.20, lon:3.28, baseColor:"tribe",
    info:{ history:"52 г.: восстание; 51 г.: окончательно покорены.", about:"Бассейн верхней Сены; Агединкум (Сенс)." }, cite:"Pleiades",
    events:[ {date:"-52-06", status:"Revolt", note:"Восстание"}, {date:"-51-07", status:"Conquered", note:"Подчинены"} ] },
  { name:"Remi (Ремы)", type:"tribe", lat:49.25, lon:4.03, baseColor:"tribe",
    info:{ history:"С 57 г. верные союзники; земли — база снабжения.", about:"Окрестности Дурокорторума (Реймса)." }, cite:"Pleiades",
    events:[ {date:"-57-05", status:"Ally", note:"Союз перед битвой у Аксона"} ] },

  // ==== ГОРОДА ====
  { name:"Lutetia (Лютеция)", type:"city", lat:48.8547, lon:2.3475, baseColor:"city",
    info:{ history:"52 г.: район под контролем Рима после кампании Лабиена.", about:"Город парисиев на Сене, предтеча Парижа." }, cite:"WP",
    events:[ {date:"-52-07", status:"Conquered", note:"Римский контроль"} ] },
  { name:"Portus Itius (Порт Итрий)", type:"city", lat:50.96, lon:1.85, baseColor:"city",
    info:{ history:"55–54 гг.: база экспедиций Цезаря в Британию.", about:"Локализация спорна; вероятно район Булони/Виссана." }, cite:"LacusCurtius; WP",
    events:[ {date:"-55-07", status:"Ally", note:"Сбор флота"} ] },
  { name:"Samarobriva (Самаробрива/Амьен)", type:"city", lat:49.892, lon:2.299, baseColor:"city",
    info:{ history:"54 г.: место общего совета провинции; римский узел.", about:"Оппидум на Сомме; позже Амьен." }, cite:"WP",
    events:[ {date:"-54-07", status:"Conquered", note:"Административный центр"} ] },
  { name:"Lugdunum (Лугдунум/Лион)", type:"city", lat:45.7601, lon:4.8194, baseColor:"city",
    info:{ history:"Основан в 43 г. до н.э.; вне рамок войны, но ключевой центр позже.", about:"Крупный римский город у слияния Сонны и Роны." }, cite:"WP",
    events:[ ] },
  { name:"Genava (Женева)", type:"city", lat:46.2044, lon:6.1432, baseColor:"city",
    info:{ history:"58 г.: разрушен мост через Рону для остановки гельветов.", about:"Город у выхода Роны из озера Леман." }, cite:"BG 1",
    events:[ {date:"-58-03", status:"Ally", note:"Римский гарнизон у моста"} ] },
  { name:"Octodurus (Октодур/Мартиньи)", type:"city", lat:46.0943, lon:7.0735, baseColor:"city",
    info:{ history:"57/56 г.: зимняя битва; римляне удержали лагерь, затем отошли.", about:"Позднее Forum Claudii Vallensium (Мартиньи)." }, cite:"WP",
    events:[ {date:"-57-12", status:"Conquered", note:"Победа, временный контроль"} ] },
  { name:"Vienna (Вьенна)", type:"city", lat:45.5250, lon:4.8786, baseColor:"city",
    info:{ history:"Аллоброги покорены ранее (120); при Цезаре — база провинции.", about:"Римский город на Роне." }, cite:"WP",
    events:[ {date:"-59-01", status:"Ally", note:"Провинциальный центр"} ] },
  { name:"Gergovia (Гергавия)", type:"city", lat:45.7201, lon:3.1189, baseColor:"city",
    info:{ history:"52 г.: неудачная осада Цезаря; удержана арвернами.", about:"Плато к югу от Клермон-Феррана." }, cite:"WP",
    events:[ {date:"-52-06", status:"Revolt", note:"Успешная оборона"} ] },
  { name:"Bibracte (Бибракте)", type:"city", lat:46.9231, lon:4.0375, baseColor:"city",
    info:{ history:"58 г.: близ города — поражение гельветов; штаб Цезаря.", about:"Оппидум на Мон-Бёвре; позже центр переносится в Августодунум." }, cite:"WP",
    events:[ {date:"-58-06", status:"Ally", note:"Штаб после битвы"} ] },
  { name:"Alesia (Алезия)", type:"city", lat:47.5393, lon:4.5001, baseColor:"city",
    info:{ history:"52 г.: капитуляция Верцингеторикса; ключевая победа.", about:"Мон-Осуа, совр. Ализ-Сент-Рен." }, cite:"WP",
    events:[ {date:"-52-09", status:"Conquered", note:"Капитуляция"} ] },
  { name:"Avaricum (Аварикум/Бурж)", type:"city", lat:47.0844, lon:2.3964, baseColor:"city",
    info:{ history:"52 г.: взятие после осады; жёсткий разгром.", about:"Оппидум битуригов на Луаре (Бурж)." }, cite:"WP",
    events:[ {date:"-52-04", status:"Conquered", note:"Осада и штурм"} ] },
  { name:"Cenabum (Кенаб/Орлеан)", type:"city", lat:47.902, lon:1.909, baseColor:"city",
    info:{ history:"52 г.: штурм за резню купцов; город разрушен.", about:"Столица карнутов; порт на Луаре; позднее Орлеан." }, cite:"WP",
    events:[ {date:"-52-02", status:"Conquered", note:"Штурм и разрушение"} ] },
  { name:"Bibrax (Бибракс)", type:"city", lat:49.498, lon:3.821, baseColor:"city",
    info:{ history:"57 г.: осада белгов; Цезарь снимает осаду, затем битва у Аксона.", about:"Оппидум ремов; локализация у Saint-Thomas (Эна)." }, cite:"WP",
    events:[ {date:"-57-05", status:"Ally", note:"Гарнизон помогает обороне"} ] }
];

// ===== КАРТА =====
const map = L.map('map').setView([46.5, 3], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 10,
  minZoom: 4,
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);
const layerTribeAreas = L.layerGroup().addTo(map);
const layerTribePoints = L.layerGroup();
const layerCities = L.layerGroup().addTo(map);

function baseStylePoint(e){ return { radius: e.type==='city'?6:7, color:'#000', weight:1, fillColor: e.type==='city'?'#4aa3ff':'#f0c419', fillOpacity:0.9 }; }
function conqueredStylePoint(){ return { color:'#000', weight:1, fillColor:'#d93741', fillOpacity:0.95, radius:7 }; }
function allyStylePoint(e){ const st=baseStylePoint(e); st.fillColor='#22c55e'; return st; }

function baseStylePoly(){ return { color:'#000', weight:1, fillColor:'#f0c419', fillOpacity:0.25 }; }
function conqueredStylePoly(){ return { color:'#000', weight:1, fillColor:'#d93741', fillOpacity:0.35 }; }
function allyStylePoly(){ return { color:'#000', weight:1, fillColor:'#22c55e', fillOpacity:0.30 }; }

function makeCircle(lat, lon, radiusKm=60, steps=48){
  const R=6371, pts=[]; const latR=lat*Math.PI/180;
  for(let i=0;i<steps;i++){
    const ang = 2*Math.PI*i/steps;
    const dLat = (radiusKm/R)*(180/Math.PI)*Math.sin(ang);
    const dLon = (radiusKm/R)*(180/Math.PI)*Math.cos(ang)/Math.cos(latR);
    pts.push([lat+dLat, lon+dLon]);
  }
  return pts;
}
function radiusForTribe(name){
  const n = name.toLowerCase();
  if(n.includes('helvet')) return 90;
  if(n.includes('sequan')) return 80;
  if(n.includes('aedui')||n.includes('haedui')) return 80;
  if(n.includes('lingon')) return 70;
  if(n.includes('parisii')) return 55;
  if(n.includes('senon')) return 70;
  if(n.includes('remi')) return 70;
  if(n.includes('eburon')) return 75;
  if(n.includes('atrebat')) return 65;
  if(n.includes('bellovac')) return 70;
  if(n.includes('morini')) return 60;
  if(n.includes('menapi')) return 60;
  return 60;
}

const markers = [];
const tribePolys = [];
ENTITIES.forEach(ent => {
  // Точки
  const marker = L.circleMarker([ent.lat, ent.lon], baseStylePoint(ent));
  marker._entity = ent;
  const elId = `ev-${slugify(ent.name)}`;
  marker.bindPopup(`
    <strong>${ent.name}</strong><br>
    <span class="muted small">${ent.type==='city'?'Город':'Племя'}</span>
    <div class="small" style="margin-top:6px;">
      <div><strong>Краткая история захвата:</strong> ${ent.info?.history || '—'}</div>
      <div><strong>Справка:</strong> ${ent.info?.about || '—'}</div>
      <div class="muted" style="margin-top:4px;">Источник: ${ent.cite || ''}</div>
    </div>
    <div id="${elId}" class="small" style="margin-top:6px;"></div>
  `);
  marker._elId = elId;
  if(ent.type==='city') layerCities.addLayer(marker); else layerTribePoints.addLayer(marker);
  markers.push(marker);

  // Полигоны для племён
  if(ent.type==='tribe'){
    const polyCoords = ent.area && ent.area.length ? ent.area : makeCircle(ent.lat, ent.lon, radiusForTribe(ent.name));
    const poly = L.polygon(polyCoords, baseStylePoly());
    poly._entity = ent; poly._elId = elId;
    poly.bindPopup(marker.getPopup().getContent());
    layerTribeAreas.addLayer(poly);
    tribePolys.push(poly);
  }
});

function statusAt(entity, key){
  const cur = keyToIdx(key);
  const evs = [...(entity.events||[])].sort((a,b)=>compareKeysChrono(a.date,b.date)).filter(e => keyToIdx(e.date) <= cur);
  if(!evs.length) return {kind:'base', note:''};
  const last = evs[evs.length-1];
  if(last.status==='Conquered') return {kind:'conq', note:last.note};
  if(last.status==='Ally') return {kind:'ally', note:last.note};
  if(last.status==='Revolt') return {kind:'base', note:last.note};
  return {kind:'base', note:last.note||''};
}

function applyStylesAt(index){
  const key = idxToKey(index);
  document.getElementById('dateOut').textContent = idxToLabel(index);
  markers.forEach(m => {
    const st = statusAt(m._entity, key);
    if(st.kind==='conq') m.setStyle(conqueredStylePoint());
    else if(st.kind==='ally') m.setStyle(allyStylePoint(m._entity));
    else m.setStyle(baseStylePoint(m._entity));
    const el = document.getElementById(m._elId);
    if(el){
      const evs = [...(m._entity.events||[])].sort((a,b)=>compareKeysChrono(a.date,b.date)).filter(e => keyToIdx(e.date) <= keyToIdx(key));
      if(evs.length){
        const last = evs[evs.length-1];
        el.innerHTML = `<div><strong>Событие:</strong> ${last.status==='Conquered'?'Захват': last.status==='Ally'?'Союз':'Мятеж/сопротивление'}</div><div class=\"muted\">${last.note||''} (${last.date.replace('-', '')} г. до н.э.)</div>`;
      } else { el.textContent = 'Событий пока не было'; }
    }
  });
  tribePolys.forEach(p => {
    const st = statusAt(p._entity, key);
    if(st.kind==='conq') p.setStyle(conqueredStylePoly());
    else if(st.kind==='ally') p.setStyle(allyStylePoly());
    else p.setStyle(baseStylePoly());
  });
}

// ===== UI =====
const time = document.getElementById('time');
const playBtn = document.getElementById('play');
const showTribeAreas = document.getElementById('showTribeAreas');
const showTribePoints = document.getElementById('showTribePoints');
const showCities = document.getElementById('showCities');

time.addEventListener('input', ()=> applyStylesAt(parseInt(time.value,10)));
showTribeAreas.addEventListener('change', ()=> showTribeAreas.checked?map.addLayer(layerTribeAreas):map.removeLayer(layerTribeAreas));
showTribePoints.addEventListener('change', ()=> showTribePoints.checked?map.addLayer(layerTribePoints):map.removeLayer(layerTribePoints));
showCities.addEventListener('change', ()=> showCities.checked?map.addLayer(layerCities):map.removeLayer(layerCities));

let timer = null;
function tick(){
  let v = parseInt(time.value,10);
  v = (v+1) % (parseInt(time.max,10)+1); // вперёд по времени
  time.value = String(v);
  applyStylesAt(v);
}
playBtn.addEventListener('click', ()=>{
  if(timer){ clearInterval(timer); timer=null; playBtn.textContent='▶'; return; }
  playBtn.textContent='⏸';
  timer = setInterval(tick, 900);
});

// ===== САМОПРОВЕРКИ (тесты, результат в консоли) =====
function assert(cond, msg){ if(cond) console.log('✓', msg); else console.error('✗', msg); }
(function runTests(){
  try{
    assert(Array.isArray(ENTITIES), 'ENTITIES определён как массив');
    const need = ['Menapii','Morini','Eburones','Atrebates','Bellovaci','Helvetii','Sequani','Aedui','Lingones','Parisii','Senones','Remi','Lutetia','Portus Itius','Samarobriva','Lugdunum','Genava','Octodurus','Vienna','Gergovia','Bibracte','Alesia','Avaricum','Cenabum','Bibrax'];
    const names = new Set(ENTITIES.map(e=>e.name));
    need.forEach(n=> assert([...names].some(x=>x.toLowerCase().includes(n.toLowerCase())), `Наличие объекта: ${n}`));
    assert(ENTITIES.every(e=>Array.isArray(e.events)), 'У всех объектов есть массив events');
    // Проверка хронологии: -59 раньше -58 и т.д.
    assert(compareKeysChrono('-59-01','-58-01') < 0, 'Хронология BCE корректна (-59 раньше -58)');
    assert(compareKeysChrono('-58-05','-58-06') < 0, 'Месяцы возрастают внутри года');
    // Проверка статусов: Гельветы до июня 58 не захвачены, после — захвачены
    const helv = ENTITIES.find(e=>/helvetii/i.test(e.name));
    assert(helv, 'Гельветы присутствуют');
    const s1 = statusAt(helv, '-58-05');
    const s2 = statusAt(helv, '-58-06');
    assert(s1.kind!=='conq', 'Гельветы до -58-06 не красные');
    assert(s2.kind==='conq', 'Гельветы на -58-06 и позже красные');
    // Полигоны созданы
    assert(tribePolys.length >= ENTITIES.filter(e=>e.type==='tribe').length*0.9, 'Полигоны для племён созданы');
  } catch(err){ console.error('Ошибка тестов:', err); }
})();

// Инициализация
// По умолчанию племенные точки скрыты, контуры и города видны
map.removeLayer(layerTribePoints);
applyStylesAt(parseInt(time.value,10));
</script>
</body>
</html>
